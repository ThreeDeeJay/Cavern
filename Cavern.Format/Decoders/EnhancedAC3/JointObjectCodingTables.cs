using Cavern.Channels;

namespace Cavern.Format.Decoders.EnhancedAC3 {
    enum HuffmanType {
        /// <summary>
        /// Matrix.
        /// </summary>
        MTX,
        /// <summary>
        /// Vector.
        /// </summary>
        VEC,
        /// <summary>
        /// Index.
        /// </summary>
        IDX
    }

    /// <summary>
    /// Hardcoded values for JOC decoding.
    /// </summary>
    static class JointObjectCodingTables {
        /// <summary>
        /// Implementation of joc_get_huff_code, gets the corresponding Huffman table.
        /// </summary>
        /// <remarks>Does not handle invalid modes correctly.</remarks>
        public static int[][] GetHuffCodeTable(int mode, HuffmanType type) => type switch {
            HuffmanType.MTX => mode == 1 ? joc_huff_code_fine_generic : joc_huff_code_coarse_generic,
            HuffmanType.VEC => mode == 1 ? joc_huff_code_fine_coeff_sparse : joc_huff_code_coarse_coeff_sparse,
            _ => mode == 7 ? joc_huff_code_7ch_pos_index_sparse : joc_huff_code_5ch_pos_index_sparse,
        };

        /// <summary>
        /// The order of input channels for JOC matrix mixing.
        /// </summary>
        public static readonly ReferenceChannel[] inputMatrix = new ReferenceChannel[] {
            ReferenceChannel.FrontLeft, ReferenceChannel.FrontRight, ReferenceChannel.FrontCenter,
            ReferenceChannel.SideLeft, ReferenceChannel.SideRight, ReferenceChannel.RearLeft, ReferenceChannel.RearRight
        };

        public static readonly byte[] joc_num_bands = { 1, 3, 5, 7, 9, 12, 15, 23 };

        public static readonly byte[][] parameterBandMapping = {
            new byte[] { 0 },
            new byte[] { 0, 3, 14 },
            new byte[] { 0, 1, 3, 9, 23 },
            new byte[] { 0, 1, 2, 4, 8, 14, 23 },
            new byte[] { 0, 1, 2, 3, 5, 7, 9, 14, 23 },
            new byte[] { 0, 1, 2, 3, 4, 6, 8, 11, 14, 18, 23, 35 },
            new byte[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 14, 18, 23, 35 },
            new byte[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 23, 26, 30, 35, 41, 48 }
        };

        static readonly int[][] joc_huff_code_coarse_generic = {
            new[] {  -1,   1}, new[] {   2,  -2}, new[] { -96,   3}, new[] {   4,  -3}, new[] { -95,   5},
            new[] {   6,   7}, new[] {  -4, -94}, new[] {   8,   9}, new[] {  -5, -93}, new[] {  10,  11},
            new[] {  -6, -92}, new[] {  12,  13}, new[] {  -7, -91}, new[] {  14,  15}, new[] {  16, -90},
            new[] {  -8,  17}, new[] {  18, -89}, new[] {  -9,  19}, new[] {  20,  21}, new[] { -88, -10},
            new[] {  22,  23}, new[] { -11, -87}, new[] {  24,  25}, new[] {  26, -86}, new[] { -12,  27},
            new[] {  28, -85}, new[] { -13,  29}, new[] {  30,  31}, new[] {  32, -84}, new[] { -14,  33},
            new[] {  34, -15}, new[] { -83,  35}, new[] {  36,  37}, new[] { -16,  38}, new[] { -17, -82},
            new[] {  39,  40}, new[] {  41, -81}, new[] {  42,  43}, new[] {  44,  45}, new[] {  46,  47},
            new[] {  48,  49}, new[] {  50,  51}, new[] {  52, -18}, new[] { -78,  53}, new[] { -19,  54},
            new[] {  55,  56}, new[] {  57,  58}, new[] { -22,  59}, new[] {  60,  61}, new[] {  62,  63},
            new[] {  64,  65}, new[] {  66,  67}, new[] {  68, -20}, new[] { -21, -79}, new[] { -80, -25},
            new[] {  69,  70}, new[] { -26,  71}, new[] {  72,  73}, new[] {  74,  75}, new[] {  76,  77},
            new[] {  78,  79}, new[] {  80,  81}, new[] {  82,  83}, new[] {  84,  85}, new[] {  86,  87},
            new[] {  88,  89}, new[] {  90,  91}, new[] {  92,  93}, new[] {  94, -23}, new[] { -74, -75},
            new[] { -72, -73}, new[] { -76, -77}, new[] { -34, -35}, new[] { -32, -33}, new[] { -38, -39},
            new[] { -36, -37}, new[] { -30, -31}, new[] { -28, -29}, new[] { -50, -51}, new[] { -48, -49},
            new[] { -54, -55}, new[] { -52, -53}, new[] { -42, -43}, new[] { -40, -41}, new[] { -46, -47},
            new[] { -44, -45}, new[] { -66, -67}, new[] { -64, -65}, new[] { -70, -71}, new[] { -68, -69},
            new[] { -58, -59}, new[] { -56, -57}, new[] { -62, -63}, new[] { -60, -61}, new[] { -24, -27}
        };

        static readonly int[][] joc_huff_code_fine_generic = {
            new[] {  -1,   1}, new[] {   2,   3}, new[] {  -2,-192}, new[] {   4,   5}, new[] {   6,  -3},
            new[] {-191,   7}, new[] {   8,   9}, new[] {  -4,-190}, new[] {  10,  11}, new[] {  -5,-189},
            new[] {  12,  13}, new[] {  -6,  14}, new[] {-188,  15}, new[] {  16,  -7}, new[] {-187,  17},
            new[] {  18,  -8}, new[] {-186,  19}, new[] {  20,  -9}, new[] {-185,  21}, new[] {  22, -10},
            new[] {-184,  23}, new[] {  24, -11}, new[] {  25,-183}, new[] {  26,  27}, new[] { -12,-182},
            new[] {  28,  29}, new[] { -13,-181}, new[] {  30,  31}, new[] {-180, -14}, new[] {  32,  33},
            new[] {  34,-179}, new[] { -15,  35}, new[] {  36,-178}, new[] { -16,  37}, new[] {  38,-177},
            new[] {  39, -17}, new[] {  40,  41}, new[] {-176,  42}, new[] { -18,  43}, new[] { -19,  44},
            new[] {-175,  45}, new[] {  46,-174}, new[] { -20,  47}, new[] {-173,  48}, new[] {  49, -21},
            new[] {  50,  51}, new[] {  52, -22}, new[] {  53,  54}, new[] {-172,  55}, new[] {-171, -23},
            new[] {  56,  57}, new[] {  58,-170}, new[] {  59, -24}, new[] { -25,  60}, new[] {-169,  61},
            new[] {  62,  63}, new[] {  64,  65}, new[] {  66,  67}, new[] {-168,  68}, new[] { -26,  69},
            new[] {-167, -27}, new[] {  70,-166}, new[] {-165,  71}, new[] { -29,  72}, new[] {  73,  74},
            new[] { -30,  75}, new[] {  76,  77}, new[] {  78,  79}, new[] {  80, -28}, new[] {  81,  82},
            new[] {  83,-163}, new[] { -31, -33}, new[] {-164,-161}, new[] {  84,  85}, new[] {  86,  87},
            new[] {  88,  89}, new[] {  90,  91}, new[] {  92,  93}, new[] {  94,  95}, new[] {  96,  97},
            new[] {  98,  99}, new[] { -32,-162}, new[] { 100, 101}, new[] { 102, 103}, new[] { 104, 105},
            new[] { 106, 107}, new[] { 108, 109}, new[] { 110, 111}, new[] {-160, 112}, new[] { -36, -38},
            new[] { 113, 114}, new[] { 115, 116}, new[] { 117, 118}, new[] { 119, 120}, new[] { 121, 122},
            new[] { 123, 124}, new[] { 125, 126}, new[] { 127, 128}, new[] { 129, 130}, new[] { 131, 132},
            new[] { 133, -35}, new[] {-158, 134}, new[] {-155,-156}, new[] { -37, -42}, new[] { 135, 136},
            new[] { 137, 138}, new[] { 139, 140}, new[] { 141, 142}, new[] { 143, 144}, new[] { 145, 146},
            new[] { 147, 148}, new[] { 149, 150}, new[] { 151, 152}, new[] { 153, 154}, new[] { 155, 156},
            new[] { 157, 158}, new[] { 159, 160}, new[] { 161, 162}, new[] { 163, 164}, new[] { 165, 166},
            new[] { 167, 168}, new[] { 169, 170}, new[] { 171, 172}, new[] { 173, 174}, new[] { 175, 176},
            new[] { 177, 178}, new[] { 179, 180}, new[] { 181, 182}, new[] { 183, 184}, new[] {-157, 185},
            new[] { -45, -48}, new[] { 186, 187}, new[] { 188, 189}, new[] { -34, -41}, new[] { 190, -39},
            new[] { -60, -61}, new[] { -58, -59}, new[] { -64, -65}, new[] { -62, -63}, new[] { -52, -53},
            new[] { -50, -51}, new[] { -56, -57}, new[] { -54, -55}, new[] { -76, -77}, new[] { -74, -75},
            new[] { -80, -81}, new[] { -78, -79}, new[] { -68, -69}, new[] { -66, -67}, new[] { -72, -73},
            new[] { -70, -71}, new[] { -47, -49}, new[] { -44, -46}, new[] {-124,-125}, new[] {-122,-123},
            new[] {-128,-129}, new[] {-126,-127}, new[] {-116,-117}, new[] {-114,-115}, new[] {-120,-121},
            new[] {-118,-119}, new[] {-140,-141}, new[] {-138,-139}, new[] {-144,-145}, new[] {-142,-143},
            new[] {-132,-133}, new[] {-130,-131}, new[] {-136,-137}, new[] {-134,-135}, new[] { -92, -93},
            new[] { -90, -91}, new[] { -96, -97}, new[] { -94, -95}, new[] { -84, -85}, new[] { -82, -83},
            new[] { -88, -89}, new[] { -86, -87}, new[] {-108,-109}, new[] {-106,-107}, new[] {-112,-113},
            new[] {-110,-111}, new[] {-100,-101}, new[] { -98, -99}, new[] {-104,-105}, new[] {-102,-103},
            new[] {-154,-159}, new[] {-148,-149}, new[] {-146,-147}, new[] {-152,-153}, new[] {-150,-151},
            new[] { -40, -43}
        };

        static readonly int[][] joc_huff_code_coarse_coeff_sparse = {
            new[] {  -1,   1}, new[] {   2,   3}, new[] {  -2, -96}, new[] {   4,   5}, new[] {   6, -95},
            new[] {  -3,   7}, new[] {   8,   9}, new[] {  -4,  10}, new[] { -94,  11}, new[] {  12,  -5},
            new[] { -93,  13}, new[] {  14,  15}, new[] {  -6, -92}, new[] {  16,  17}, new[] {  18,  -7},
            new[] { -91,  19}, new[] {  20,  -8}, new[] { -90,  21}, new[] {  22,  23}, new[] {  -9, -89},
            new[] {  24,  25}, new[] {  26, -10}, new[] { -88,  27}, new[] {  28,  29}, new[] {  30, -11},
            new[] { -87,  31}, new[] {  32,  33}, new[] {  34,  35}, new[] { -12, -86}, new[] {  36,  37},
            new[] {  38, -13}, new[] {  39, -85}, new[] {  40,  41}, new[] {  42,  43}, new[] { -14, -84},
            new[] {  44,  45}, new[] {  46,  47}, new[] { -83, -15}, new[] {  48,  49}, new[] {  50, -16},
            new[] {  51,  52}, new[] { -82,  53}, new[] {  54, -81}, new[] {  55,  56}, new[] { -17,  57},
            new[] {  58, -80}, new[] {  59,  60}, new[] { -18,  61}, new[] {  62,  63}, new[] { -79,  64},
            new[] { -19, -78}, new[] {  65,  66}, new[] {  67,  68}, new[] {  69, -20}, new[] { -77, -21},
            new[] {  70,  71}, new[] {  72,  73}, new[] {  74, -76}, new[] {  75, -22}, new[] {  76,  77},
            new[] { -75,  78}, new[] {  79,  80}, new[] { -54, -74}, new[] { -73,  81}, new[] { -23,  82},
            new[] { -50, -24}, new[] { -55, -25}, new[] {  83, -47}, new[] { -49, -44}, new[] { -71,  84},
            new[] { -48, -51}, new[] {  85, -72}, new[] { -26, -53}, new[] { -70, -27}, new[] {  86, -45},
            new[] {  87,  88}, new[] { -68,  89}, new[] { -29, -43}, new[] {  90, -30}, new[] { -46, -69},
            new[] {  91, -28}, new[] { -52, -31}, new[] {  92, -32}, new[] {  93, -64}, new[] { -67,  94},
            new[] { -36, -33}, new[] { -63, -37}, new[] { -65, -61}, new[] { -66, -59}, new[] { -34, -38},
            new[] { -41, -42}, new[] { -35, -60}, new[] { -39, -57}, new[] { -56, -40}, new[] { -62, -58}
        };

        static readonly int[][] joc_huff_code_fine_coeff_sparse = {
            new[] {   1,  -1}, new[] {   2,   3}, new[] {   4,  -2}, new[] {-192,   5}, new[] {   6,   7},
            new[] {   8,  -3}, new[] {-191,   9}, new[] {  10,  11}, new[] {  12,-190}, new[] {  -4,  13},
            new[] {  14,  15}, new[] {-189,  -5}, new[] {  16,  17}, new[] {  18,  -6}, new[] {-188,  19},
            new[] {  20,  21}, new[] {  -7,-187}, new[] {  22,  23}, new[] {  -8,  24}, new[] {-186,  25},
            new[] {  -9,  26}, new[] {  27,-185}, new[] {  28, -10}, new[] {  29,  30}, new[] {-184,  31},
            new[] { -11,  32}, new[] {  33,-183}, new[] {  34, -12}, new[] {  35,-182}, new[] {  36,  37},
            new[] {  38, -13}, new[] {-181,  39}, new[] {  40, -14}, new[] {  41,-180}, new[] {  42,  43},
            new[] {-179, -15}, new[] {  44, -16}, new[] {  45,-178}, new[] {  46,  47}, new[] {  48,  49},
            new[] {  50,-177}, new[] { -17,  51}, new[] { -18,  52}, new[] {-176,  53}, new[] {  54,  55},
            new[] {-175, -19}, new[] {  56,  57}, new[] {  58, -20}, new[] {  59,-174}, new[] {  60,  61},
            new[] { -21,  62}, new[] {  63,-173}, new[] {  64,  65}, new[] {  66,-172}, new[] {  67,  68},
            new[] { -22,  69}, new[] {  70,  71}, new[] { -23,  72}, new[] {-171,  73}, new[] {  74,  75},
            new[] {  76, -24}, new[] {  77,-170}, new[] { -25,  78}, new[] {  79,  80}, new[] {  81,-169},
            new[] {  82,  83}, new[] {  84, -26}, new[] {  85,-168}, new[] {  86,  87}, new[] {  88,  89},
            new[] {-167,  90}, new[] { -27,  91}, new[] {  92, -28}, new[] {  93,-166}, new[] {  94, -29},
            new[] {  95,  96}, new[] {  97,  98}, new[] {-165,  99}, new[] { 100, -30}, new[] {-164, 101},
            new[] { 102, 103}, new[] { 104, 105}, new[] {-163, 106}, new[] { -31, 107}, new[] { -32, 108},
            new[] { 109, 110}, new[] {-161, 111}, new[] {-160,-162}, new[] { 112, -34}, new[] { -33, 113},
            new[] { 114, 115}, new[] { 116, 117}, new[] { 118, 119}, new[] { 120,-159}, new[] { 121, 122},
            new[] { 123,-158}, new[] { 124, 125}, new[] { -36,-155}, new[] { 126, 127}, new[] { -35, 128},
            new[] { 129, 130}, new[] {-157, 131}, new[] {-156, 132}, new[] { -37, 133}, new[] { 134, 135},
            new[] {-154, -38}, new[] { 136, 137}, new[] { -39, -41}, new[] { 138,-153}, new[] { 139, -40},
            new[] {-149, 140}, new[] { 141, 142}, new[] { 143, 144}, new[] {-151, 145}, new[] { 146, 147},
            new[] { 148, -42}, new[] { -43, 149}, new[] { 150, 151}, new[] {-152, 152}, new[] { -46, -98},
            new[] { 153, 154}, new[] { 155,-147}, new[] { 156, 157}, new[] { 158,-107}, new[] { 159, 160},
            new[] {-145,-150}, new[] { -96, 161}, new[] { 162, -45}, new[] {-146, 163}, new[] { 164, -97},
            new[] {-108,-105}, new[] {-148,-106}, new[] { -44, 165}, new[] { -94,-141}, new[] { -99, 166},
            new[] { -89, 167}, new[] { -50, -95}, new[] {-100, -48}, new[] {-144, 168}, new[] { 169, 170},
            new[] { -51,-142}, new[] { -90, -91}, new[] { -47, -49}, new[] { 171, -53}, new[] { -93,-143},
            new[] {-137,-138}, new[] { -55,-101}, new[] { 172, 173}, new[] { -54, -86}, new[] { -88, -87},
            new[] {-103, 174}, new[] { 175, -61}, new[] {-109, 176}, new[] { 177, 178}, new[] { -52,-139},
            new[] { -57,-140}, new[] { 179, 180}, new[] { -56,-136}, new[] { -58,-102}, new[] { 181, 182},
            new[] { -60,-135}, new[] { 183,-104}, new[] {-128,-134}, new[] { -92, 184}, new[] { -59, -62},
            new[] { 185, 186}, new[] { -71,-133}, new[] { 187,-127}, new[] {-126, 188}, new[] { -63, -64},
            new[] { -85,-132}, new[] { 189, -66}, new[] {-121,-125}, new[] { 190, -68}, new[] { -74, -75},
            new[] { -70, -73}, new[] { -81, -65}, new[] {-118,-131}, new[] { -72,-110}, new[] {-119,-120},
            new[] { -76, -84}, new[] {-122,-130}, new[] { -83,-117}, new[] { -69, -78}, new[] { -80, -82},
            new[] {-123,-124}, new[] { -67,-116}, new[] {-129, -77}, new[] {-113,-114}, new[] {-112,-115},
            new[] { -79,-111}
        };

        static readonly int[][] joc_huff_code_5ch_pos_index_sparse = {
            new[] {  -1,   1}, new[] {   2,   3}, new[] {  -4,  -3}, new[] {  -2,  -5}
        };

        static readonly int[][] joc_huff_code_7ch_pos_index_sparse = {
            new[] {  -1,   1}, new[] {   2,   3}, new[] {   4,   5}, new[] {  -4,  -3}, new[] {  -2,  -5}, new[] {  -6,  -7}
        };
    }
}